{% extends 'base.html' %}

{% block content %}
<code>{{ path }}</code>
<nav id="pagenav">
    <a onclick="pa.input('Rename to:');">rename</a> | 
    <a onclick="pa.boolean('! WARNING !<br />really delete?', 'delete');">delete</a>
</nav>
<div id="content">
{{ content|safe }}
</div>

<script src="{{ relroot }}_static/polalert.js"></script>
<script>
    var path = '{{ path }}';
    var relroot = '{{ relroot }}';
    var deleteUrl = '{{ relroot }}_delete/{{ path }}';
    
    async function save() {
        const response = await fetch(updateUrl, {
            method: 'PUT', // *GET, POST, PUT, DELETE, etc.
            mode: 'cors', // no-cors, *cors, same-origin
            cache: 'default', // *default, no-cache, reload, force-cache, only-if-cached
            credentials: 'same-origin', // include, *same-origin, omit
            headers: {
                'Content-Type': 'text/plain'
            },
            body: document.getElementById('source').value
        });
        location.reload();
        //return response.json(); // parses JSON response into native JavaScript objects
    }
    function paOk(str) {
        if (str == 'delete') {
            deletePage();
        }
    }
    function paNo(str) {
        pa.message('Ok, nothing happened!');
    }
    async function deletePage() {
        const response = await fetch(deleteUrl, {
            method: 'DELETE', // *GET, POST, PUT, DELETE, etc.
        });
        window.location.href = relroot;
    }
    async function paInputReceive(inputtext) {
        if (inputtext != false) {
            var moveUrl = relroot+'_move/'+path;
            var dest = path.substring(0, path.lastIndexOf('/'));
            var filename = inputtext+path.substring(path.lastIndexOf('.'));
            var m = {'filePath':moveUrl, 'destPath':dest, filename:filename};
            const response = await fetch(moveUrl, {
                method: 'PUT', // *GET, POST, PUT, DELETE, etc.
                mode: 'cors', // no-cors, *cors, same-origin
                cache: 'default', // *default, no-cache, reload, force-cache, only-if-cached
                credentials: 'same-origin', // include, *same-origin, omit
                headers: {
                    'Content-Type': 'text/plain'
                },
                body: JSON.stringify(m)
            });
            response.text().then(function (text) {
                if (text=='0'){
                    window.location.href = relroot+dest+'/'+filename;
                } else {
                    pa.error('ERROR: <br />'+text);
                }
            });
        }
    }
</script>
{% endblock %}

